<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS Concepts Quiz</title>
    <style>
        :root {
            --primary-color: #f1c40f;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --neutral-color: #f5f5f5;
            --text-color: #333;
            --border-color: #ddd;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            line-height: 1.6;
            color: var(--text-color);
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
            background-color: #f9f9f9;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
        }
        
        .quiz-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .quiz-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            font-size: 1.2rem;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .quiz-body {
            padding: 20px;
        }
        
        .quiz-question {
            margin-bottom: 15px;
            font-weight: 500;
            line-height: 1.4;
        }
        
        .code-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 768px) {
            .code-section {
                flex-direction: row;
            }
            
            .css-view, .html-view, .result-view {
                width: 33.33%;
            }
        }
        
        .css-view, .html-view, .result-view {
            border: 1px solid var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .section-header {
            background-color: #f0f0f0;
            padding: 8px 12px;
            font-weight: 500;
            border-bottom: 1px solid var(--border-color);
        }
        
        .css-code, .html-code {
            padding: 12px;
            font-family: monospace;
            white-space: pre-wrap;
            background-color: #f8f8f8;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .result-container {
            padding: 12px;
            min-height: 200px;
            background-color: white;
            overflow: auto;
        }
        
        .code-editor {
            width: 100%;
            min-height: 100px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            margin-bottom: 15px;
            resize: vertical;
            background-color: #f8f8f8;
        }
        
        .button-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .navigation-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        button:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .feedback {
            margin: 15px 0px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .success {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
            border: 1px solid var(--success-color);
            display: block;
        }
        
        .error {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--error-color);
            border: 1px solid var(--error-color);
            display: block;
        }
        
        .hints {
            margin: 10px 0px;
            color: #666;
            font-style: italic;
        }
        
        .hint-text {
            display: none;
            margin: 10px 0px;
            padding: 10px;
            background-color: #fffde7;
            border-left: 3px solid #ffd600;
        }
        
        .hint-button {
            background-color: #f5f5f5;
            color: #333;
            margin: 10px 0px;
        }
        
        .question-nav {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin: 20px 0;
        }
        
        .question-btn {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f5f5f5;
            color: #333;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .question-btn:hover {
            background-color: #e0e0e0;
        }
        
        .question-btn.current {
            background-color: var(--primary-color);
            color: white;
        }
        
        .question-btn.answered {
            background-color: var(--success-color);
            color: white;
        }
        
        .nav-btn {
            background-color: #f5f5f5;
            color: #333;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 15px;
            }
            
            .quiz-header {
                padding: 12px;
                font-size: 1.1rem;
            }
            
            .quiz-body {
                padding: 15px;
            }
            
            button {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .code-editor {
                min-height: 80px;
            }
            
            .question-btn {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
            
            .navigation-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation-container button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>CSS Concepts Quiz</h1>
    
    <div id="quizContainer" class="quiz-container">
        <div class="quiz-header">
            <div>Question <span id="questionNumber">1</span> of <span id="totalQuestions">15</span></div>
            <div>Score: <span id="currentScore">0</span>/<span id="totalQuestions2">15</span></div>
        </div>
        
        <div class="question-nav" id="questionNav">
            <!-- Question navigation buttons will be generated here -->
        </div>
        
        <div class="quiz-body">
            <div class="quiz-question" id="question"></div>
            
            <div class="code-section">
                <div class="html-view">
                    <div class="section-header">HTML</div>
                    <pre class="html-code" id="htmlCode"></pre>
                </div>
                <div class="css-view">
                    <div class="section-header">Starting CSS</div>
                    <pre class="css-code" id="cssCode"></pre>
                </div>
                <div class="result-view">
                    <div class="section-header">Result (Preview)</div>
                    <div class="result-container" id="resultContainer"></div>
                </div>
            </div>
            
            <div class="section-header">Your CSS Code</div>
            <textarea class="code-editor" id="codeEditor" spellcheck="false"></textarea>
            
            <div class="hints">
                <button class="hint-button" id="hintButton">Show Hint</button>
                <div class="hint-text" id="hintText"></div>
            </div>
            
            <div class="feedback" id="feedback"></div>
            
            <div class="button-container">
                <button id="checkButton">Check Answer</button>
                <button id="resetButton">Reset Code</button>
                <button id="runButton">Run Code</button>
            </div>
            
            <div class="navigation-container">
                <button class="nav-btn" id="prevButton">Previous Question</button>
                <button class="nav-btn" id="nextButton">Next Question</button>
            </div>
        </div>
    </div>
    
    <script>
        // Quiz questions with HTML, CSS, test cases, and hints
        const questions = [
            {
                question: "Use a class selector to make all elements with class 'highlight' have a yellow background",
                html: `<div>
  <p>This is a normal paragraph.</p>
  <p class="highlight">This paragraph should have a yellow background.</p>
  <p>This is another normal paragraph.</p>
  <p class="highlight">This should also have a yellow background.</p>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const highlightRule = style.match(/\.highlight\s*{[^}]*background(-color)?:\s*yellow/i);
                    return !!highlightRule;
                },
                hint: ".highlight {\n  background-color: yellow;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use an ID selector to make the element with ID 'header' have a blue text color",
                html: `<div>
  <h1 id="header">This heading should be blue</h1>
  <p>This is a normal paragraph.</p>
  <h2>This is a normal heading.</h2>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const idRule = style.match(/#header\s*{[^}]*color:\s*(blue|#0000ff|rgb\(\s*0\s*,\s*0\s*,\s*255\s*\)|rgba\(\s*0\s*,\s*0\s*,\s*255\s*,\s*1\s*\))/i);
                    return !!idRule;
                },
                hint: "#header {\n  color: blue;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use a descendant selector to make only the list items inside the navigation have a gray background",
                html: `<nav>
  <ul>
    <li>Home</li>
    <li>About</li>
    <li>Contact</li>
  </ul>
</nav>

<ul>
  <li>This is a normal list item</li>
  <li>This should not have a gray background</li>
</ul>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const descendantRule = style.match(/nav\s+li|nav\s+ul\s+li/i);
                    const hasBackground = style.match(/background(-color)?:\s*(gray|grey|#808080|rgb\(\s*128\s*,\s*128\s*,\s*128\s*\))/i);
                    return !!descendantRule && !!hasBackground;
                },
                hint: "nav li {\n  background-color: gray;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use a direct child selector to style only the paragraphs that are direct children of the section",
                html: `<section>
  <p>This paragraph should have a red border</p>
  <div>
    <p>This paragraph should NOT have a red border</p>
  </div>
  <p>This paragraph should have a red border</p>
</section>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const childRule = style.match(/section\s*>\s*p/i);
                    const hasBorder = style.match(/border:\s*([1-9][0-9]*px|thin|medium|thick)\s+(solid|dotted|dashed)\s+red/i) || 
                                     style.match(/border(-color)?:\s*red/i);
                    return !!childRule && !!hasBorder;
                },
                hint: "section > p {\n  border: 1px solid red;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use an adjacent sibling selector to add a top margin to paragraphs that come immediately after headings",
                html: `<div>
  <h2>A heading</h2>
  <p>This paragraph should have a top margin of 20px</p>
  <p>This paragraph should NOT have the special margin</p>
  <h2>Another heading</h2>
  <p>This paragraph should have a top margin of 20px</p>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const siblingRule = style.match(/h[1-6]\s*\+\s*p/i);
                    const hasMargin = style.match(/margin-top:\s*20px/i);
                    return !!siblingRule && !!hasMargin;
                },
                hint: "h2 + p {\n  margin-top: 20px;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use a general sibling selector to make all paragraphs that follow a heading within the same parent have italic text",
                html: `<div>
  <p>This paragraph should NOT be italic</p>
  <h2>A heading</h2>
  <p>This paragraph should be italic</p>
  <p>This paragraph should also be italic</p>
  <div>
    <p>This paragraph should NOT be italic (different parent)</p>
  </div>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const generalSiblingRule = style.match(/h[1-6]\s*~\s*p/i);
                    const hasItalic = style.match(/font-style:\s*italic/i);
                    return !!generalSiblingRule && !!hasItalic;
                },
                hint: "h2 ~ p {\n  font-style: italic;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use an attribute selector to style all links that open in a new tab (have target='_blank')",
                html: `<div>
  <a href="https://example.com">Regular link</a>
  <a href="https://example.com" target="_blank">Opens in new tab (should be green)</a>
  <a href="https://example.org">Another regular link</a>
  <a href="https://example.org" target="_blank">Also opens in new tab (should be green)</a>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const attributeRule = style.match(/a\[target=["']?_blank["']?\]/i);
                    const hasColor = style.match(/color:\s*(green|#00ff00|#008000|rgb\(\s*0\s*,\s*128\s*,\s*0\s*\))/i);
                    return !!attributeRule && !!hasColor;
                },
                hint: "a[target=\"_blank\"] {\n  color: green;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use a pseudo-class to style links differently when hovered (make them underlined)",
                html: `<div>
  <a href="#" id="test-link">Hover over me</a>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const hoverRule = style.match(/a:hover/i);
                    const hasUnderline = style.match(/text-decoration:\s*underline/i);
                    return !!hoverRule && !!hasUnderline;
                },
                hint: "a:hover {\n  text-decoration: underline;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use the :nth-child pseudo-class to style every odd row in the table with a light gray background",
                html: `<table>
  <tr><td>Row 1 (should have gray background)</td></tr>
  <tr><td>Row 2</td></tr>
  <tr><td>Row 3 (should have gray background)</td></tr>
  <tr><td>Row 4</td></tr>
  <tr><td>Row 5 (should have gray background)</td></tr>
</table>`,
                css: `table {
  border-collapse: collapse;
  width: 100%;
}
td {
  padding: 8px;
  border: 1px solid #ddd;
}

/* Add your CSS here */
`,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const nthChildRule = style.match(/tr:nth-child\(\s*odd\s*\)/i);
                    const hasBackground = style.match(/background(-color)?:\s*(#f2f2f2|lightgray|lightgrey|rgb\(\s*242\s*,\s*242\s*,\s*242\s*\))/i);
                    return !!nthChildRule && !!hasBackground;
                },
                hint: "tr:nth-child(odd) {\n  background-color: #f2f2f2;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use the ::before pseudo-element to add a '★' character before each item in the list",
                html: `<ul class="star-list">
  <li>First item</li>
  <li>Second item</li>
  <li>Third item</li>
</ul>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const beforeRule = style.match(/\.star-list\s+li::before/i);
                    const hasContent = style.match(/content:\s*["']★["']/);
                    return !!beforeRule && !!hasContent;
                },
                hint: ".star-list li::before {\n  content: \"★\";\n  margin-right: 5px;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Define a CSS variable (custom property) at the root level and use it for the text color of all paragraphs",
                html: `<div>
  <p>This paragraph should use the variable color</p>
  <p>This paragraph should also use the variable color</p>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const variableDefinition = style.match(/:root\s*{[^}]*--[a-z0-9-]+:\s*[^;]+;/i);
                    const variableUsage = style.match(/p\s*{[^}]*color:\s*var\(--[a-z0-9-]+\)/i);
                    return !!variableDefinition && !!variableUsage;
                },
                hint: ":root {\n  --text-color: purple;\n}\n\np {\n  color: var(--text-color);\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use the calc() function to set the width of the box to be 100% minus 40px",
                html: `<div class="container" style="width: 300px; border: 1px solid black; padding: 10px;">
  <div class="box" style="height: 50px; background-color: lightblue;">
    This box should have width: calc(100% - 40px)
  </div>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const calcRule = style.match(/\.box\s*{[^}]*width:\s*calc\(\s*100%\s*-\s*40px\s*\)/i);
                    return !!calcRule;
                },
                hint: ".box {\n  width: calc(100% - 40px);\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use a media query to change the text color to red when the screen width is 600px or less",
                html: `<div>
  <p>This text should change color on small screens</p>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const mediaQuery = style.match(/@media\s*\(\s*max-width:\s*600px\s*\)/i);
                    const hasColor = style.match(/p\s*{[^}]*color:\s*red/i);
                    return !!mediaQuery && !!hasColor;
                },
                hint: "@media (max-width: 600px) {\n  p {\n    color: red;\n  }\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use flexbox to center the content both horizontally and vertically within the container",
                html: `<div class="flex-container" style="height: 150px; border: 2px dashed gray;">
  <div class="centered-item" style="background-color: lightblue; padding: 20px;">
    Center me!
  </div>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const flexDisplay = style.match(/\.flex-container\s*{[^}]*display:\s*flex/i);
                    const justifyContent = style.match(/\.flex-container\s*{[^}]*justify-content:\s*center/i);
                    const alignItems = style.match(/\.flex-container\s*{[^}]*align-items:\s*center/i);
                    return !!flexDisplay && !!justifyContent && !!alignItems;
                },
                hint: ".flex-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use CSS Grid to create a 2x2 grid with 20px gap between items",
                html: `<div class="grid-container">
  <div style="background-color: lightblue; padding: 20px;">Item 1</div>
  <div style="background-color: lightgreen; padding: 20px;">Item 2</div>
  <div style="background-color: lightyellow; padding: 20px;">Item 3</div>
  <div style="background-color: lightpink; padding: 20px;">Item 4</div>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const gridDisplay = style.match(/\.grid-container\s*{[^}]*display:\s*grid/i);
                    const gridTemplateColumns = style.match(/\.grid-container\s*{[^}]*grid-template-columns:\s*([^;]*repeat\(2,\s*1fr\)|[^;]*1fr\s+1fr)/i);
                    const gridGap = style.match(/\.grid-container\s*{[^}]*(grid-gap|gap):\s*20px/i);
                    return !!gridDisplay && !!gridTemplateColumns && !!gridGap;
                },
                hint: ".grid-container {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 20px;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Use the transform property to rotate an element 45 degrees",
                html: `<div style="padding: 50px;">
  <div class="rotated-box" style="width: 100px; height: 100px; background-color: coral;">
    Rotate me!
  </div>
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const transformRule = style.match(/\.rotated-box\s*{[^}]*transform:\s*rotate\(\s*45deg\s*\)/i);
                    return !!transformRule;
                },
                hint: ".rotated-box {\n  transform: rotate(45deg);\n}",
                userCode: '',
                answered: false,
                correct: false
            },
            {
                question: "Create a CSS animation that changes the background color of the box from blue to red over 2 seconds, repeating infinitely",
                html: `<div class="animated-box" style="width: 100px; height: 100px;">
  Animate me!
</div>`,
                css: ``,
                testFunction: function(styleElement) {
                    const style = styleElement.textContent;
                    const keyframesRule = style.match(/@keyframes\s+[a-z0-9-]+\s*{[^}]*}/i);
                    const animationRule = style.match(/\.animated-box\s*{[^}]*animation:\s*[a-z0-9-]+\s+2s\s+.*infinite/i);
                    const backgroundChange = style.match(/background(-color)?:\s*(blue|red|#0000ff|#ff0000)/gi);
                    return !!keyframesRule && !!animationRule && (backgroundChange && backgroundChange.length >= 2);
                },
                hint: "@keyframes color-change {\n  0% { background-color: blue; }\n  100% { background-color: red; }\n}\n\n.animated-box {\n  animation: color-change 2s infinite alternate;\n}",
                userCode: '',
                answered: false,
                correct: false
            },
        ];

        // Quiz state
        let currentQuestion = 0;
        let score = 0;

        // DOM elements
        const questionElement = document.getElementById('question');
        const htmlCodeElement = document.getElementById('htmlCode');
        const cssCodeElement = document.getElementById('cssCode');
        const resultContainerElement = document.getElementById('resultContainer');
        const codeEditor = document.getElementById('codeEditor');
        const feedbackElement = document.getElementById('feedback');
        const checkButton = document.getElementById('checkButton');
        const resetButton = document.getElementById('resetButton');
        const runButton = document.getElementById('runButton');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const hintButton = document.getElementById('hintButton');
        const hintText = document.getElementById('hintText');
        const questionNumberElement = document.getElementById('questionNumber');
        const totalQuestionsElement = document.getElementById('totalQuestions');
        const totalQuestionsElement2 = document.getElementById('totalQuestions2');
        const currentScoreElement = document.getElementById('currentScore');
        const questionNavElement = document.getElementById('questionNav');

        // Initialize quiz
        function initQuiz() {
            totalQuestionsElement.textContent = questions.length;
            totalQuestionsElement2.textContent = questions.length;
            createQuestionNav();
            loadQuestion(0);
            updateNavButtons();
        }

        // Create question navigation
        function createQuestionNav() {
            questionNavElement.innerHTML = '';
            for (let i = 0; i < questions.length; i++) {
                const btn = document.createElement('div');
                btn.className = 'question-btn';
                btn.textContent = i + 1;
                btn.addEventListener('click', () => {
                    saveCurrentAnswer();
                    loadQuestion(i);
                });
                questionNavElement.appendChild(btn);
            }
            updateQuestionNav();
        }

        // Update question navigation styling
        function updateQuestionNav() {
            const navButtons = questionNavElement.querySelectorAll('.question-btn');
            navButtons.forEach((btn, index) => {
                btn.classList.remove('current', 'answered');
                if (index === currentQuestion) {
                    btn.classList.add('current');
                }
                if (questions[index].answered) {
                    btn.classList.add('answered');
                }
            });
        }

        // Load question by index
        function loadQuestion(index) {
            currentQuestion = index;
            const question = questions[currentQuestion];
            
            questionElement.textContent = question.question;
            htmlCodeElement.textContent = question.html;
            cssCodeElement.textContent = question.css;
            codeEditor.value = question.userCode;
            
            // Reset and populate the result container with HTML and default CSS
            resultContainerElement.innerHTML = question.html;
            
            // Apply the starting CSS
            applyCSS(question.css);
            
            if (question.answered) {
                if (question.correct) {
                    feedbackElement.className = 'feedback success';
                    feedbackElement.textContent = 'Correct! Well done!';
                } else {
                    feedbackElement.className = 'feedback error';
                    feedbackElement.textContent = 'That\'s not quite right. You can try again!';
                }
            } else {
                feedbackElement.className = 'feedback';
                feedbackElement.textContent = '';
            }
            
            questionNumberElement.textContent = currentQuestion + 1;
            hintText.style.display = 'none';
            
            updateQuestionNav();
            updateNavButtons();
            updateScore();
        }

        // Apply CSS to the result container
        function applyCSS(cssText) {
            // Remove any existing style element
            const existingStyle = resultContainerElement.querySelector('style');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            // Create and append a new style element
            const styleElement = document.createElement('style');
            styleElement.textContent = cssText;
            resultContainerElement.appendChild(styleElement);
            
            return styleElement;
        }

        // Save current answer
        function saveCurrentAnswer() {
            questions[currentQuestion].userCode = codeEditor.value;
        }

        // Run the user's code
        function runCode() {
            saveCurrentAnswer();
            
            const userCode = questions[currentQuestion].userCode.trim();
            
            if (userCode === '') {
                feedbackElement.className = 'feedback error';
                feedbackElement.textContent = 'Please write some CSS before running.';
                return;
            }
            
            try {
                // Combine the starting CSS with the user's CSS
                const combinedCSS = questions[currentQuestion].css + '\n\n' + userCode;
                
                // Apply the combined CSS
                applyCSS(combinedCSS);
                
                feedbackElement.className = 'feedback';
                feedbackElement.textContent = 'Code executed. Check the result.';
            } catch (error) {
                feedbackElement.className = 'feedback error';
                feedbackElement.textContent = `Error: ${error.message}`;
            }
        }

        // Check the answer
        function checkAnswer() {
            saveCurrentAnswer();
            
            const userCode = questions[currentQuestion].userCode.trim();
            
            if (userCode === '') {
                feedbackElement.className = 'feedback error';
                feedbackElement.textContent = 'Please write some CSS before checking.';
                return;
            }
            
            // Run the code first
            try {
                // Combine the starting CSS with the user's CSS
                const combinedCSS = questions[currentQuestion].css + '\n\n' + userCode;
                
                // Apply the combined CSS and get the style element
                const styleElement = applyCSS(combinedCSS);
                
                // Then check if the result is correct
                const isCorrect = questions[currentQuestion].testFunction(styleElement);
                
                questions[currentQuestion].answered = true;
                questions[currentQuestion].correct = isCorrect;
                
                if (isCorrect) {
                    feedbackElement.className = 'feedback success';
                    feedbackElement.textContent = 'Correct! Well done!';
                    if (!questions[currentQuestion].correct) {
                        score++;
                        updateScore();
                    }
                } else {
                    feedbackElement.className = 'feedback error';
                    feedbackElement.textContent = 'That\'s not quite right. You can try again!';
                }
                
                updateQuestionNav();
            } catch (error) {
                feedbackElement.className = 'feedback error';
                feedbackElement.textContent = `Error: ${error.message}`;
            }
        }

        // Reset current question code
        function resetCode() {
            codeEditor.value = '';
            questions[currentQuestion].userCode = '';
            feedbackElement.className = 'feedback';
            feedbackElement.textContent = '';
            
            // Reset the result container with just the starting CSS
            applyCSS(questions[currentQuestion].css);
        }

        // Navigate to previous question
        function prevQuestion() {
            if (currentQuestion > 0) {
                saveCurrentAnswer();
                loadQuestion(currentQuestion - 1);
            }
        }

        // Navigate to next question
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                saveCurrentAnswer();
                loadQuestion(currentQuestion + 1);
            }
        }

        // Update navigation buttons state
        function updateNavButtons() {
            prevButton.disabled = currentQuestion === 0;
            nextButton.disabled = currentQuestion === questions.length - 1;
        }

        // Show hint
        function showHint() {
            const hint = questions[currentQuestion].hint;
            hintText.textContent = hint;
            hintText.style.display = 'block';
        }

        // Calculate score
        function calculateScore() {
            score = 0;
            for (const question of questions) {
                if (question.correct) {
                    score++;
                }
            }
            return score;
        }

        // Update score display
        function updateScore() {
            score = calculateScore();
            currentScoreElement.textContent = score;
        }

        // Event listeners
        checkButton.addEventListener('click', checkAnswer);
        resetButton.addEventListener('click', resetCode);
        runButton.addEventListener('click', runCode);
        prevButton.addEventListener('click', prevQuestion);
        nextButton.addEventListener('click', nextQuestion);
        hintButton.addEventListener('click', showHint);

        // Initialize the quiz
        initQuiz();
    </script>
</body>
</html>
